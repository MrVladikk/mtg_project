MTG Project Documentation

Версия: 1.6
Автор: MrVladikk
Дата: Май 2025

1. Обзор проекта

MTG Project – это веб-приложение, разработанное на основе Django для управления коллекцией карт Magic: The Gathering. Приложение предоставляет следующие возможности:

Импорт данных о карточках из CSV/Excel-файлов.
Скачивание изображений карт с API Scryfall.
Обновление ссылок на изображения в базе данных.
Управление колодами (добавление, редактирование, удаление) через административную панель.
Управление проектом посредством Django management commands, что позволяет запускать задачи (импорт, обновление, добавление колод) через manage.py.
**Новое:** Отображение количества карточек на всех страницах (коллекция, сеты, колоды).
**Новое:** Улучшенный поиск карт по названию, сету и редкости.
**Новое:** Добавлена функция сортировки по алфавиту.
**Новое:** Добавлена форма регистрации.
**Новое:** Добавлена форма для входа (login).
**Новое:** Добавлена форма для выхода (logout) с использованием POST-запросов для безопасности.
**Новое:** Добавлена функция формирования колод через сайт ("Добавить колоду").
**Новое:** Добавлена возможность добавлять карты через сайт ("Добавить карту").
**Добавлена сортировка по цене:** Теперь карты можно сортировать по возрастанию или убыванию цены.
**Новое:** Добалена функция загрузки CSV файла через интерфес сайта.(а не через команды как это было раньше). Обработка файла происходит автоматически.

**Сортировка по цене добавлена во все разделы:**

- Список карт
- Карты в сетах
- Карты в колодах

**Приватные колоды:** Пользователи могут создавать колоды, скрытые от других.
**Фильтрация колод:** В списке отображаются только публичные колоды и приватные колоды владельца.
**Добавлена кнопка "Удалить колоду"** Теперь пользователи могут удалять свои колоды по нажатию кнопки.
**Добавлен форум** Теперь пользователи могут общаться и обсуждать темы на форуме.
**Добавлен аукцион** Теперь пользователи могут создавать и учавствовать в аукционах(ВАЖНО!!! АУКЦИОН НЕ БУДЕТ ОТОБРАЖАТЬСЯ ПОКА АДМИН ЕГО НЕ ПОДТВЕРДИТ).

2.  Стек технологий

Python 3.12
Django 4.2 – основной веб-фреймворк
SQLite – база данных (по умолчанию; для продакшена рекомендуется PostgreSQL)
Requests – для выполнения HTTP-запросов
Pandas – для обработки CSV/Excel файлов
tqdm – для отображения прогресс-бара при загрузке изображений
Gunicorn – для запуска в продакшене
psycopg2-binary – для работы с PostgreSQL (если потребуется)
django-environ – для управления переменными окружения (рекомендуется)

3. Структура проекта

mtg_project/ # Корневая директория проекта
├── db.sqlite3 # Файл базы данных (SQLite)
├── manage.py # Основная точка входа Django
├── requirements.txt # Файл зависимостей проекта
├── mtg_app/ # Приложение Django для работы с MTG
│ ├── admin.py # Настройка административной панели
│ ├── apps.py # Конфигурация приложения
│ ├── models.py # Определение моделей (Card, Set, Deck)
│ ├── tests/ # Папка с тестами
│ │ ├── test_mtg_project.py # Файл с тестами проекта
│ ├── management/ # Django management commands
│ │ ├── **init**.py
│ │ └── commands/
│ │ ├── **init**.py
│ │ ├── import_cards.py # Команда для импорта карт из CSV (из определенного пути)
│ │ ├── download_images.py # Команда для скачивания изображений
│ │ ├── update_image_urls.py # Команда для обновления ссылок на изображения
│ │ └── add_deck.py # Команда для импорта колод из текстового файла
│ ├── parser_mtg/ # Папка с парсерами (если используются отдельно)
│ │ └── my_cards.csv # Пример CSV-файла с данными карточек (может использоваться командами)
│ └── static/
│ └── mtg_app/
│ └── images/
│ └── cards # Папка для хранения скачанных изображений
└── mtg_project/ # Директория с настройками проекта
├── **init**.py
├── asgi.py
├── settings.py # Основные настройки Django
├── urls.py # URL-конфигурация проекта
└── wsgi.py

4. Установка и настройка

Клонирование репозитория:

git clone https://github.com/MrVladikk/mtg_project.git
cd mtg_project
Создание виртуального окружения и установка зависимостей:
python -m venv venv

# Linux/macOS:

source venv/bin/activate

# Windows:

venv\Scripts\activate
pip install -r requirements.txt
Применение миграций и запуск сервера:

python manage.py makemigrations
python manage.py migrate
python manage.py runserver
Откройте браузер по адресу: http://127.0.0.1:8000.

5. Модели и администрирование

Основные модели (определены в mtg_app/models.py):

Set – хранит информацию о наборах карт.
Card – содержит данные о каждой карте (название, сет, номер, редкость, цена, ссылка на изображение и т.д.).
Deck – позволяет создавать колоды, объединяющие множество карт (связь ManyToMany).
Административная панель:

Модели зарегистрированы в mtg_app/admin.py.
Создайте суперпользователя:
python manage.py createsuperuser
Перейдите по адресу: http://127.0.0.1:8000/admin.

6. Management Commands

В проекте реализованы пользовательские команды для автоматизации задач.
**Примечание:** В дополнение к командам, импорт CSV также возможен через веб-интерфейс.

import_cards:
Запускается командой:
python manage.py import_cards
Считывает данные о картах из CSV-файла и добавляет их в базу данных (модели `Set` и `Card`). **Важно:** В текущей версии команды путь к CSV-файлу (`my_cards.csv`) жестко прописан внутри кода команды (`C:\Users\User\Desktop\mtg_project\mtg_app\management\commands\my_cards.csv`). Убедитесь, что файл находится по этому пути или измените путь в коде команды.

download_images:
Запускается командой:
python manage.py download_images
Считывает данные из CSV-файла (`my_cards.csv`), получает изображения по Scryfall ID и сохраняет их в папку `mtg_app/static/mtg_app/images/cards`. (Предполагается, что этот CSV содержит необходимые идентификаторы для скачивания).

update_image_urls:
Запускается командой:
python manage.py update_image_urls
Команда проходит по всем объектам `Card` в базе данных, формирует имя файла на основе названия карты и номера коллекции, проверяет наличие файла в `mtg_app/static/mtg_app/images/cards/` и обновляет поле `image_url` в базе данных.

add_deck:
Запускается командой:
python manage.py add_deck --deck_file "path/to/deck_file.txt" --deck_name "Название колоды" --deck_description "Описание колоды"
Команда читает текстовый файл с описанием колоды, ищет соответствующие объекты `Card` в базе данных и добавляет их в созданную колоду `Deck`.

7. Тестирование

Проект включает набор тестов для проверки основного функционала, написанных с использованием Pytest и стандартного тестового клиента Django.

**Запуск тестов:**

Для запуска всех тестов в проекте выполните команду из корневой директории проекта:
``bash
pytest
Или, если вы хотите запустить тесты для конкретного приложения (например, mtg_app):

Bash

python manage.py test mtg_app
Покрытие тестами:

Тесты покрывают следующие аспекты:

Создание и базовую логику моделей (Card, Set, Deck).
Доступность основных представлений (списки карт и колод).
Функциональность команд управления (import_cards, update_image_urls, add_deck).
Рекомендуется поддерживать и расширять тестовое покрытие при добавлении нового функционала или изменении существующего.

Фронтенд и стили
Проект использует кастомные CSS-стили, определённые в mtg_app/static/mtg_app/styles.css, для оформления:

Общего оформления (фон, шрифты, цвета).
Заголовка, навигации и геро-секции.
Карточек карт и страниц с деталями.
Футера, который прижат к низу экрана с помощью Flexbox.
Пример обновлённого CSS для фиксации футера:

html, body {
margin: 0;
padding: 0;
height: 100%;
}

.wrapper {
display: flex;
flex-direction: column;
min-height: 100vh;
}

.content {
flex: 1;
}

footer {
background: #2e2b25;
padding: 20px;
text-align: center;
color: #d4c8a2;
font-size: 1rem;
border-top: 3px solid #c8a24a;
}
Важно: Убедитесь, что базовый HTML-шаблон содержит контейнер <div class="wrapper"> с элементами header, main (с классом .content) и footer.

Развертывание
Настройки для продакшена:

Перейдите на PostgreSQL вместо SQLite.
В файле mtg_project/settings.py установите:
DEBUG = False
ALLOWED_HOSTS = ['ваш_домен', 'IP_адрес_сервера']
Выполните сбор статических файлов:

python manage.py collectstatic
Используйте Gunicorn и Nginx для продакшена.

Заключение
MTG Project – это мощное Django-приложение для коллекционеров карт Magic: The Gathering. Проект включает:

Импорт данных и загрузку изображений через management commands, а также импорт CSV через веб-интерфейс.
Удобное управление коллекцией через административную панель.
Набор тестов для проверки ключевых функций.
Современный фронтенд с кастомными CSS-стилями.